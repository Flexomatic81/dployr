<%- include('../partials/pageHeader', {
    title: t('projects:title'),
    titleIcon: 'bi-folder',
    primaryAction: { href: '/projects/create', label: t('projects:newProject'), icon: 'bi-plus-lg' }
}) %>

<% const hasSharedProjects = sharedProjects && sharedProjects.length > 0; %>

<% if (hasSharedProjects) { %>
<!-- Tabs for My/Shared Projects -->
<ul class="nav nav-tabs mb-4" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="my-projects-tab" data-bs-toggle="tab" data-bs-target="#my-projects" type="button" role="tab">
            <i class="bi bi-folder-fill"></i> <%= t('projects:myProjects') %>
            <span class="badge bg-primary-subtle ms-1"><%= projects.length %></span>
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="shared-projects-tab" data-bs-toggle="tab" data-bs-target="#shared-projects" type="button" role="tab">
            <i class="bi bi-share-fill"></i> <%= t('projects:sharedProjects') %>
            <span class="badge bg-info-subtle ms-1"><%= sharedProjects.length %></span>
        </button>
    </li>
</ul>

<div class="tab-content">
    <!-- My Projects Tab -->
    <div class="tab-pane fade show active" id="my-projects" role="tabpanel">
<% } %>

<div class="d-table-shell">
    <%- include('../components/tableShell', {
        title: t('projects:myProjects'),
        titleIcon: 'bi-folder'
    }) %>
    <div class="d-table-shell-body">
        <% if (projects.length === 0) { %>
            <%- include('../components/emptyState', {
                title: t('projects:noProjects'),
                description: t('projects:noProjectsHint'),
                icon: 'bi-folder-x',
                primaryAction: { href: '/projects/create', label: t('projects:createFirst'), icon: 'bi-plus-lg' }
            }) %>
        <% } else { %>
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th><%= t('common:labels.name') %></th>
                            <th><%= t('common:labels.type') %></th>
                            <th><%= t('common:labels.port') %></th>
                            <th><%= t('projects:info.container') %></th>
                            <th><%= t('projects:info.git') %></th>
                            <th><%= t('common:labels.status') %></th>
                            <th class="text-end"><%= t('common:labels.actions') %></th>
                        </tr>
                    </thead>
                    <tbody>
                        <% projects.forEach(project => { %>
                            <tr>
                                <td>
                                    <a href="/projects/<%= project.name %>" class="fw-medium">
                                        <i class="bi bi-folder-fill text-warning me-1"></i>
                                        <%= project.name %>
                                    </a>
                                </td>
                                <td>
                                    <% if (project.templateType === 'php-website') { %>
                                        <span class="badge bg-purple">PHP</span>
                                    <% } else if (project.templateType === 'nodejs-app') { %>
                                        <span class="badge bg-success-subtle">Node.js</span>
                                    <% } else if (project.templateType === 'laravel') { %>
                                        <span class="badge bg-danger-subtle">Laravel</span>
                                    <% } else if (project.templateType === 'python-flask' || project.templateType === 'python-django') { %>
                                        <span class="badge bg-warning-subtle">Python</span>
                                    <% } else if (project.templateType === 'nextjs') { %>
                                        <span class="badge bg-dark">Next.js</span>
                                    <% } else if (project.templateType === 'nuxtjs') { %>
                                        <span class="badge bg-success">Nuxt.js</span>
                                    <% } else if (project.templateType === 'nodejs-static') { %>
                                        <span class="badge bg-info-subtle">SPA</span>
                                    <% } else if (project.templateType === 'custom') { %>
                                        <span class="badge bg-warning-subtle text-warning"><i class="bi bi-gear-wide-connected"></i> <%= t('projects:types.custom') %></span>
                                    <% } else { %>
                                        <span class="badge bg-secondary">Static</span>
                                    <% } %>
                                </td>
                                <td><code><%= project.port %></code></td>
                                <td>
                                    <span class="text-muted">
                                        <%= project.runningContainers %>/<%= project.totalContainers %>
                                    </span>
                                </td>
                                <td>
                                    <% if (project.gitConnected) { %>
                                        <span class="badge bg-success-subtle">
                                            <i class="bi bi-check-circle"></i> <%= t('projects:git.connected') %>
                                        </span>
                                    <% } else { %>
                                        <span class="text-muted">â€”</span>
                                    <% } %>
                                </td>
                                <td>
                                    <% if (project.status === 'running') { %>
                                        <span class="badge bg-success-subtle">
                                            <i class="bi bi-check-circle"></i> <%= t('common:status.running') %>
                                        </span>
                                    <% } else { %>
                                        <span class="badge bg-secondary">
                                            <i class="bi bi-stop-circle"></i> <%= t('common:status.stopped') %>
                                        </span>
                                    <% } %>
                                </td>
                                <td class="text-end">
                                    <a href="/projects/<%= project.name %>" class="btn btn-sm btn-outline-primary btn-icon" title="<%= t('common:buttons.details') %>">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                    <% if (project.status === 'running') { %>
                                        <form action="/projects/<%= project.name %>/stop" method="POST" class="d-inline">
                                            <%- csrfInput %>
                                            <button type="submit" class="btn btn-sm btn-outline-danger btn-icon" title="<%= t('common:buttons.stop') %>">
                                                <i class="bi bi-stop-fill"></i>
                                            </button>
                                        </form>
                                    <% } else { %>
                                        <form action="/projects/<%= project.name %>/start" method="POST" class="d-inline">
                                            <%- csrfInput %>
                                            <button type="submit" class="btn btn-sm btn-outline-success btn-icon" title="<%= t('common:buttons.start') %>">
                                                <i class="bi bi-play-fill"></i>
                                            </button>
                                        </form>
                                    <% } %>
                                    <a href="/logs/<%= project.name %>" class="btn btn-sm btn-outline-secondary btn-icon" title="<%= t('common:buttons.logs') %>">
                                        <i class="bi bi-terminal"></i>
                                    </a>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        <% } %>
    </div>
</div>

<% if (hasSharedProjects) { %>
    </div><!-- End my-projects tab-pane -->

    <!-- Shared Projects Tab -->
    <div class="tab-pane fade" id="shared-projects" role="tabpanel">
        <div class="d-table-shell">
            <%- include('../components/tableShell', {
                title: t('projects:sharedProjects'),
                titleIcon: 'bi-share'
            }) %>
            <div class="d-table-shell-body">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th><%= t('common:labels.name') %></th>
                                <th><%= t('common:labels.owner') %></th>
                                <th><%= t('common:labels.permission') %></th>
                                <th><%= t('common:labels.type') %></th>
                                <th><%= t('common:labels.status') %></th>
                                <th class="text-end"><%= t('common:labels.actions') %></th>
                            </tr>
                        </thead>
                        <tbody>
                            <% sharedProjects.forEach(project => { %>
                                <tr>
                                    <td>
                                        <a href="/projects/<%= project.name %>" class="fw-medium">
                                            <i class="bi bi-folder-fill text-info me-1"></i>
                                            <%= project.name %>
                                        </a>
                                    </td>
                                    <td><%= project.shareInfo.ownerUsername %></td>
                                    <td>
                                        <span class="badge <%= project.shareInfo.permission === 'full' ? 'bg-success-subtle' : project.shareInfo.permission === 'manage' ? 'bg-primary-subtle' : 'bg-secondary' %>">
                                            <i class="bi <%= project.shareInfo.permissionIcon %>"></i>
                                            <%= project.shareInfo.permissionLabel %>
                                        </span>
                                    </td>
                                    <td>
                                        <% if (project.templateType === 'php-website') { %>
                                            <span class="badge bg-purple">PHP</span>
                                        <% } else if (project.templateType === 'nodejs-app') { %>
                                            <span class="badge bg-success-subtle">Node.js</span>
                                        <% } else if (project.templateType === 'laravel') { %>
                                            <span class="badge bg-danger-subtle">Laravel</span>
                                        <% } else if (project.templateType === 'python-flask' || project.templateType === 'python-django') { %>
                                            <span class="badge bg-warning-subtle">Python</span>
                                        <% } else if (project.templateType === 'nextjs') { %>
                                            <span class="badge bg-dark">Next.js</span>
                                        <% } else if (project.templateType === 'nuxtjs') { %>
                                            <span class="badge bg-success">Nuxt.js</span>
                                        <% } else if (project.templateType === 'nodejs-static') { %>
                                            <span class="badge bg-info-subtle">SPA</span>
                                        <% } else if (project.templateType === 'custom') { %>
                                            <span class="badge bg-warning-subtle text-warning"><i class="bi bi-gear-wide-connected"></i> <%= t('projects:types.custom') %></span>
                                        <% } else { %>
                                            <span class="badge bg-secondary">Static</span>
                                        <% } %>
                                    </td>
                                    <td>
                                        <% if (project.status === 'running') { %>
                                            <span class="badge bg-success-subtle">
                                                <i class="bi bi-check-circle"></i> <%= t('common:status.running') %>
                                            </span>
                                        <% } else { %>
                                            <span class="badge bg-secondary">
                                                <i class="bi bi-stop-circle"></i> <%= t('common:status.stopped') %>
                                            </span>
                                        <% } %>
                                    </td>
                                    <td class="text-end">
                                        <% const canManage = project.shareInfo.permission === 'manage' || project.shareInfo.permission === 'full'; %>
                                        <a href="/projects/<%= project.name %>" class="btn btn-sm btn-outline-primary btn-icon" title="<%= t('common:buttons.details') %>">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                        <% if (canManage) { %>
                                            <% if (project.status === 'running') { %>
                                                <form action="/projects/<%= project.name %>/stop" method="POST" class="d-inline">
                                                    <%- csrfInput %>
                                                    <button type="submit" class="btn btn-sm btn-outline-danger btn-icon" title="<%= t('common:buttons.stop') %>">
                                                        <i class="bi bi-stop-fill"></i>
                                                    </button>
                                                </form>
                                            <% } else { %>
                                                <form action="/projects/<%= project.name %>/start" method="POST" class="d-inline">
                                                    <%- csrfInput %>
                                                    <button type="submit" class="btn btn-sm btn-outline-success btn-icon" title="<%= t('common:buttons.start') %>">
                                                        <i class="bi bi-play-fill"></i>
                                                    </button>
                                                </form>
                                            <% } %>
                                        <% } %>
                                        <a href="/logs/<%= project.name %>" class="btn btn-sm btn-outline-secondary btn-icon" title="<%= t('common:buttons.logs') %>">
                                            <i class="bi bi-terminal"></i>
                                        </a>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div><!-- End shared-projects tab-pane -->
</div><!-- End tab-content -->
<% } %>
