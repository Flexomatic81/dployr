<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/dashboard"><%= t('common:nav.dashboard') %></a></li>
        <li class="breadcrumb-item"><a href="/projects"><%= t('common:nav.projects') %></a></li>
        <li class="breadcrumb-item"><a href="/projects/<%= project.name %>"><%= project.name %></a></li>
        <li class="breadcrumb-item active"><%= t('common:buttons.logs') %></li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
        <i class="bi bi-terminal"></i> <%= t('common:buttons.logs') %> - <%= project.name %>
    </h1>
    <div>
        <button id="refreshBtn" class="btn btn-outline-primary">
            <i class="bi bi-arrow-clockwise"></i> <%= t('common:buttons.refresh') %>
        </button>
        <button id="autoRefreshBtn" class="btn btn-outline-secondary">
            <i class="bi bi-play"></i> Auto-Refresh
        </button>
    </div>
</div>

<% if (containerLogs.length === 0) { %>
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i>
        <%= t('logs:noContainers', { defaultValue: 'No containers found. Start the project to see logs.' }) %>
    </div>
<% } else { %>
    <div class="accordion" id="logsAccordion">
        <% containerLogs.forEach((container, index) => { %>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button <%= index === 0 ? '' : 'collapsed' %>" type="button"
                            data-bs-toggle="collapse" data-bs-target="#logs-<%= index %>">
                        <i class="bi bi-box<%= container.state === 'running' ? '-fill text-success' : ' text-muted' %>"></i>
                        &nbsp; <%= container.name %>
                        <% if (container.state === 'running') { %>
                            <span class="badge bg-success ms-2"><%= t('common:status.running') %></span>
                        <% } else { %>
                            <span class="badge bg-secondary ms-2"><%= container.state %></span>
                        <% } %>
                    </button>
                </h2>
                <div id="logs-<%= index %>" class="accordion-collapse collapse <%= index === 0 ? 'show' : '' %>"
                     data-bs-parent="#logsAccordion">
                    <div class="accordion-body p-0">
                        <pre class="log-output mb-0" data-container="<%= container.name %>"><%= container.logs || t('logs:noLogs', { defaultValue: 'No logs available' }) %></pre>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
<% } %>

<div class="mt-3">
    <a href="/projects/<%= project.name %>" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> <%= t('common:buttons.back') %>
    </a>
</div>

<script>
    const projectName = '<%= project.name %>';
    let autoRefresh = null;

    document.getElementById('refreshBtn').addEventListener('click', refreshLogs);

    document.getElementById('autoRefreshBtn').addEventListener('click', function() {
        if (autoRefresh) {
            clearInterval(autoRefresh);
            autoRefresh = null;
            this.innerHTML = '<i class="bi bi-play"></i> Auto-Refresh';
            this.classList.remove('btn-primary');
            this.classList.add('btn-outline-secondary');
        } else {
            autoRefresh = setInterval(refreshLogs, 5000);
            this.innerHTML = '<i class="bi bi-stop"></i> Stop';
            this.classList.remove('btn-outline-secondary');
            this.classList.add('btn-primary');
            refreshLogs();
        }
    });

    async function refreshLogs() {
        try {
            const response = await fetch(`/logs/${projectName}/api?lines=200`);
            const data = await response.json();

            data.containerLogs.forEach(container => {
                const pre = document.querySelector(`pre[data-container="${container.name}"]`);
                if (pre) {
                    pre.textContent = container.logs || '<%= t("logs:noLogs", { defaultValue: "No logs available" }) %>';
                    pre.scrollTop = pre.scrollHeight;
                }
            });
        } catch (error) {
            console.error('Error refreshing logs:', error);
        }
    }
</script>
