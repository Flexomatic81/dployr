version: '3.8'

services:
  app:
    build:
      context: ./html
      dockerfile_inline: |
        FROM python:3.12-slim
        WORKDIR /app
        RUN apt-get update && apt-get install -y libpq-dev gcc && rm -rf /var/lib/apt/lists/*
        COPY requirements.txt ./
        RUN pip install --no-cache-dir -r requirements.txt gunicorn
        COPY . .
        EXPOSE 8000
        CMD ["gunicorn", "--bind", "0.0.0.0:8000", "app:app"]
    container_name: ${PROJECT_NAME:-python-flask}
    restart: unless-stopped
    networks:
      - dployr-network
    ports:
      - "${EXPOSED_PORT:-8004}:8000"
    environment:
      - TZ=Europe/Berlin
      - FLASK_ENV=production
      - PYTHONUNBUFFERED=1

networks:
  dployr-network:
    external: true
